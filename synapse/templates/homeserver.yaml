server_name: "${SERVER_DOMAIN}"
public_baseurl: "https://synapse.${SERVER_DOMAIN}:${NGINX_HTTPS_PORT}/"
pid_file: /data/homeserver.pid
macaroon_secret_key: "some-random-secret"

listeners:
  - port: 8448
    tls: true
    type: http
    x_forwarded: true
    resources:
      - names: [client, federation]
        compress: false
  - port: 8008
    tls: false
    type: http
    x_forwarded: true
    resources:
      - names: [client]
        compress: false


report_stats: no
media_store_path: /data/media_store

allow_profile_lookup_over_federation: false

allow_public_rooms_over_federation: false
allow_public_rooms_without_auth: false

room_prejoin_state:
  disable_default_event_types: false

url_preview_enabled: false

enable_room_list_search: false

allow_guest_access: false
enable_registration: false
enable_registration_without_verification: false

database:
  name: psycopg2
  args:
    user: ${POSTGRES_USER}
    password: "${POSTGRES_PASSWORD}"
    database: ${POSTGRES_DB}
    host: ${POSTGRES_HOST}
    cp_min: 5
    cp_max: 10

tls_certificate_path: "/data/certs/${SERVER_DOMAIN}.crt"
tls_private_key_path: "/data/certs/${SERVER_DOMAIN}.key"

password_config:
  enabled: false

#Online offline status
presence:
  enabled: false

enable_registration: false


oidc_providers:
  # https://element-hq.github.io/synapse/latest/openid.html#keycloak
  - idp_id: keycloak
    idp_name: "Keycloak"
    issuer: "https://${KCDOMAIN}:9443/realms/${KCREALM}"
    client_id: "${CLIENT_ID}"
    client_secret: "${CLIENT_SECRET}"
    scopes: ["openid", "profile"]
    user_mapping_provider:
      config:
        localpart_template: "{{ user.preferred_username }}"
        display_name_template: "{{ user.name }}"
